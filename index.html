<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto-Connect Video Call</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.3.1/peerjs.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        video { width: 45%; border: 2px solid black; margin: 10px; }
    </style>
</head>
<body>
    <h2>Auto-Connect Video Call</h2>
    <video id="localVideo" autoplay muted></video>
    <video id="remoteVideo" autoplay></video>
    
    <script>
        let localStream;
        let peer = new Peer(); // Generates a random ID
        let socket = new WebSocket("https://glitch.com/edit/#!/tide-sophisticated-aluminum");
 // Replace with an actual WebSocket server

        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
            .then(stream => {
                localStream = stream;
                document.getElementById("localVideo").srcObject = stream;
            })
            .catch(error => console.error("Error accessing media devices:", error));

        peer.on('open', id => {
            console.log("Your ID: " + id);
            socket.send(JSON.stringify({ type: "join", peerId: id })); // Tell the server we are here
        });

        socket.onmessage = (event) => {
            let data = JSON.parse(event.data);
            if (data.type === "match" && data.peerId !== peer.id) {
                console.log("Matched with:", data.peerId);
                let call = peer.call(data.peerId, localStream);
                call.on('stream', remoteStream => {
                    document.getElementById("remoteVideo").srcObject = remoteStream;
                });
            }
        };

        peer.on('call', call => {
            call.answer(localStream);
            call.on('stream', remoteStream => {
                document.getElementById("remoteVideo").srcObject = remoteStream;
            });
        });
    </script>
</body>
</html>
